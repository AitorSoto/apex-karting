---
import Layout from '../layouts/Layout.astro';
import races from '../../public/data/races.json';
import circuits from '../../public/data/circuits.json';
import results from '../../public/data/results.json';
import drivers from '../../public/data/drivers.json';

// Get the last completed race (highest round number with completed status)
const completedRaces = races.filter((r: any) => r.status === 'completed').sort((a: any, b: any) => b.round - a.round);
const latestRace = completedRaces[0];
const latestRaceCircuit = latestRace ? circuits.find((c: any) => c.id === latestRace.circuitId) : null;

// Get race winner if latest race exists
let latestRaceWinner = null;
if (latestRace) {
  const winnerResult: any = results.find((r: any) => r.raceId === latestRace.id && r.position === 1);
  if (winnerResult) {
    latestRaceWinner = drivers.find((d: any) => d.id === winnerResult.driverId);
  }
}

// Get the next upcoming race (lowest round number with upcoming status)
const upcomingRaces = races.filter((r: any) => r.status === 'upcoming').sort((a: any, b: any) => a.round - b.round);
const nextRace = upcomingRaces[0];
const nextRaceCircuit = nextRace ? circuits.find((c: any) => c.id === nextRace.circuitId) : null;
---

<Layout title="Apex Karting - Inicio">
  <div class="space-y-8">
    <!-- Hero Section -->
    <div class="bg-gradient-to-br from-red-900 via-zinc-900 to-zinc-950 rounded-lg p-6 md:p-12 border-2 border-red-600">
      <h1 class="text-3xl md:text-6xl font-black mb-4 tracking-tight">
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-red-300">
          BIENVENIDO A APEX KARTING
        </span>
      </h1>
      <p class="text-base md:text-xl text-zinc-300 max-w-2xl">
        Experimenta la emoci√≥n del karting competitivo. Sigue la clasificaci√≥n, estad√≠sticas de pilotos y resultados de carreras en tiempo real.
      </p>
    </div>

    <!-- Latest & Next Race -->
    <div class="grid md:grid-cols-2 gap-6">
      {latestRace ? (
        <div class="bg-zinc-900 rounded-lg p-6 border-l-4 border-green-500">
          <div class="text-green-500 font-bold text-sm uppercase mb-2">√öltima Carrera</div>
          <h2 class="text-2xl font-bold mb-2">{latestRace.name}</h2>
          <div class="text-zinc-400 mb-1">Ronda {latestRace.round} ‚Ä¢ {latestRace.date}</div>
          {latestRaceCircuit && (
            <div class="text-sm text-zinc-500 mb-2">{latestRaceCircuit.name} ‚Ä¢ {latestRaceCircuit.location}</div>
          )}
          {latestRaceWinner && (
            <div class="mt-3 mb-3 text-sm">
              <span class="text-zinc-400">Ganador: </span>
              <span class="text-yellow-500 font-bold">üèÜ {latestRaceWinner.name}</span>
            </div>
          )}
          <a href={`/races/${latestRace.id}`} class="inline-block mt-4 px-4 py-2 bg-green-600 hover:bg-green-700 rounded font-bold text-sm transition-colors">
            Ver Resultados
          </a>
        </div>
      ) : (
        <div class="bg-zinc-900 rounded-lg p-6 border-l-4 border-zinc-700">
          <div class="text-zinc-500 font-bold text-sm uppercase mb-2">√öltima Carrera</div>
          <h2 class="text-xl font-bold mb-2 text-zinc-600">A√∫n no hay carreras completadas</h2>
          <p class="text-zinc-500">Los resultados aparecer√°n aqu√≠ despu√©s de la primera carrera.</p>
        </div>
      )}
      
      {nextRace ? (
        <div class="bg-zinc-900 rounded-lg p-6 border-l-4 border-red-500">
          <div class="text-red-500 font-bold text-sm uppercase mb-2">Pr√≥xima Carrera</div>
          <h2 class="text-2xl font-bold mb-2">{nextRace.name}</h2>
          <div class="text-zinc-400 mb-1">Ronda {nextRace.round} ‚Ä¢ {nextRace.date}</div>
          {nextRaceCircuit && (
            <div class="text-sm text-zinc-500 mb-2">
              {nextRaceCircuit.name} ‚Ä¢ {nextRaceCircuit.location}
              <div class="mt-1">{typeof nextRaceCircuit.length === 'number' ? `${nextRaceCircuit.length}km` : nextRaceCircuit.length} ‚Ä¢ {nextRaceCircuit.turns} curvas</div>
            </div>
          )}
          <a href={`/races/${nextRace.id}`} class="inline-block mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 rounded font-bold text-sm transition-colors">
            Ver Detalles
          </a>
        </div>
      ) : (
        <div class="bg-zinc-900 rounded-lg p-6 border-l-4 border-zinc-700">
          <div class="text-zinc-500 font-bold text-sm uppercase mb-2">Pr√≥xima Carrera</div>
          <h2 class="text-xl font-bold mb-2 text-zinc-600">No hay carreras pr√≥ximas</h2>
          <p class="text-zinc-500">¬°La temporada ha concluido. Vuelve m√°s tarde para la pr√≥xima temporada!</p>
        </div>
      )}
    </div>

    <!-- Quick Links -->
    <div class="grid md:grid-cols-3 gap-6">
      <a href="/standings" class="bg-zinc-900 hover:bg-zinc-800 rounded-lg p-8 border-2 border-zinc-800 hover:border-red-600 transition-all group">
        <h3 class="text-2xl font-bold mb-2 group-hover:text-red-500 transition-colors">Clasificaci√≥n del Campeonato</h3>
        <p class="text-zinc-400">Ver el ranking actual de pilotos y equipos</p>
      </a>
      
      <a href="/drivers" class="bg-zinc-900 hover:bg-zinc-800 rounded-lg p-8 border-2 border-zinc-800 hover:border-red-600 transition-all group">
        <h3 class="text-2xl font-bold mb-2 group-hover:text-red-500 transition-colors">Perfiles de Pilotos</h3>
        <p class="text-zinc-400">Explora las estad√≠sticas detalladas de los pilotos</p>
      </a>
      
      <a href="/races" class="bg-zinc-900 hover:bg-zinc-800 rounded-lg p-8 border-2 border-zinc-800 hover:border-red-600 transition-all group">
        <h3 class="text-2xl font-bold mb-2 group-hover:text-red-500 transition-colors">Calendario de Carreras</h3>
        <p class="text-zinc-400">Consulta todas las carreras pr√≥ximas</p>
      </a>
    </div>
  </div>
</Layout>
