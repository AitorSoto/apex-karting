---
import Layout from '../layouts/Layout.astro';
import races from '../../public/data/races.json';
import circuits from '../../public/data/circuits.json';
import results from '../../public/data/results.json';
import drivers from '../../public/data/drivers.json';

// Get the last completed race (highest round number with completed status)
const completedRaces = races.filter((r: any) => r.status === 'completed').sort((a: any, b: any) => b.round - a.round);
const latestRace = completedRaces[0];
const latestRaceCircuit = latestRace ? circuits.find((c: any) => c.id === latestRace.circuitId) : null;

// Get race winner if latest race exists
let latestRaceWinner = null;
if (latestRace) {
  const winnerResult = results.find((r: any) => r.raceId === latestRace.id && r.position === 1);
  if (winnerResult) {
    latestRaceWinner = drivers.find((d: any) => d.id === winnerResult.driverId);
  }
}

// Get the next upcoming race (lowest round number with upcoming status)
const upcomingRaces = races.filter((r: any) => r.status === 'upcoming').sort((a: any, b: any) => a.round - b.round);
const nextRace = upcomingRaces[0];
const nextRaceCircuit = nextRace ? circuits.find((c: any) => c.id === nextRace.circuitId) : null;
---

<Layout title="Apex Karting - Home">
  <div class="space-y-8">
    <!-- Hero Section -->
    <div class="bg-gradient-to-br from-red-900 via-zinc-900 to-zinc-950 rounded-lg p-6 md:p-12 border-2 border-red-600">
      <h1 class="text-3xl md:text-6xl font-black mb-4 tracking-tight">
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-red-300">
          WELCOME TO APEX KARTING
        </span>
      </h1>
      <p class="text-base md:text-xl text-zinc-300 max-w-2xl">
        Experience the thrill of competitive karting. Track standings, driver stats, and race results in real-time.
      </p>
    </div>

    <!-- Latest & Next Race -->
    <div class="grid md:grid-cols-2 gap-6">
      {latestRace ? (
        <div class="bg-zinc-900 rounded-lg p-6 border-l-4 border-green-500">
          <div class="text-green-500 font-bold text-sm uppercase mb-2">Latest Race</div>
          <h2 class="text-2xl font-bold mb-2">{latestRace.name}</h2>
          <div class="text-zinc-400 mb-1">Round {latestRace.round} • {latestRace.date}</div>
          {latestRaceCircuit && (
            <div class="text-sm text-zinc-500 mb-2">{latestRaceCircuit.name} • {latestRaceCircuit.location}</div>
          )}
          {latestRaceWinner && (
            <div class="mt-3 mb-3 text-sm">
              <span class="text-zinc-400">Winner: </span>
              <span class="text-yellow-500 font-bold">{latestRaceWinner.name}</span>
            </div>
          )}
          <a href={`/races/${latestRace.id}`} class="inline-block mt-4 px-4 py-2 bg-green-600 hover:bg-green-700 rounded font-bold text-sm transition-colors">
            View Results
          </a>
        </div>
      ) : (
        <div class="bg-zinc-900 rounded-lg p-6 border-l-4 border-zinc-700">
          <div class="text-zinc-500 font-bold text-sm uppercase mb-2">Latest Race</div>
          <h2 class="text-xl font-bold mb-2 text-zinc-600">No races completed yet</h2>
          <p class="text-zinc-500">Results will appear here after the first race.</p>
        </div>
      )}
      
      {nextRace ? (
        <div class="bg-zinc-900 rounded-lg p-6 border-l-4 border-red-500">
          <div class="text-red-500 font-bold text-sm uppercase mb-2">Next Race</div>
          <h2 class="text-2xl font-bold mb-2">{nextRace.name}</h2>
          <div class="text-zinc-400 mb-1">Round {nextRace.round} • {nextRace.date}</div>
          {nextRaceCircuit && (
            <div class="text-sm text-zinc-500 mb-2">
              {nextRaceCircuit.name} • {nextRaceCircuit.location}
              <div class="mt-1">{nextRaceCircuit.length}km • {nextRaceCircuit.turns} turns</div>
            </div>
          )}
          <a href={`/races/${nextRace.id}`} class="inline-block mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 rounded font-bold text-sm transition-colors">
            View Details
          </a>
        </div>
      ) : (
        <div class="bg-zinc-900 rounded-lg p-6 border-l-4 border-zinc-700">
          <div class="text-zinc-500 font-bold text-sm uppercase mb-2">Next Race</div>
          <h2 class="text-xl font-bold mb-2 text-zinc-600">No upcoming races</h2>
          <p class="text-zinc-500">The season has concluded. Check back later for the next season!</p>
        </div>
      )}
    </div>

    <!-- Quick Links -->
    <div class="grid md:grid-cols-3 gap-6">
      <a href="/standings" class="bg-zinc-900 hover:bg-zinc-800 rounded-lg p-8 border-2 border-zinc-800 hover:border-red-600 transition-all group">
        <h3 class="text-2xl font-bold mb-2 group-hover:text-red-500 transition-colors">Championship Standings</h3>
        <p class="text-zinc-400">View current driver and team rankings</p>
      </a>
      
      <a href="/drivers" class="bg-zinc-900 hover:bg-zinc-800 rounded-lg p-8 border-2 border-zinc-800 hover:border-red-600 transition-all group">
        <h3 class="text-2xl font-bold mb-2 group-hover:text-red-500 transition-colors">Driver Profiles</h3>
        <p class="text-zinc-400">Explore detailed driver statistics</p>
      </a>
      
      <a href="/races" class="bg-zinc-900 hover:bg-zinc-800 rounded-lg p-8 border-2 border-zinc-800 hover:border-red-600 transition-all group">
        <h3 class="text-2xl font-bold mb-2 group-hover:text-red-500 transition-colors">Race Calendar</h3>
        <p class="text-zinc-400">Check out all upcoming races</p>
      </a>
    </div>
  </div>
</Layout>
